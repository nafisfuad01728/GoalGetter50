<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sticky Notes</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
    <link href="/static/icon.ico" rel="icon">
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f0f0f0;
            margin: 0;
            padding: 0;
        }

        header {
            background-color: #4CAF50;
            color: white;
            padding: 10px;
            text-align: center;
        }

        nav a {
            color: white;
            margin: 0 15px;
            text-decoration: none;
        }

        .note-container {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            margin: 20px;
        }

        .sticky-note {
            width: 300px;
            height: 300px;
            background-color: #ffeb3b;
            position: relative;
            margin: 15px;
            padding: 20px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            transition: transform 0.2s, box-shadow 0.2s;
            border-radius: 8px;
            cursor: pointer;
        }

        .sticky-note:hover {
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.3);
            transform: scale(1.05);
        }

        .sticky-note textarea {
            width: 100%;
            height: 70%;
            border: none;
            outline: none;
            resize: none;
            font-size: 16px;
            background: transparent;
        }

        .control-button {
            font-size: 16px;
            padding: 10px;
            border: none;
            background-color: #4CAF50;
            color: white;
            border-radius: 4px;
            cursor: pointer;
            margin-top: 10px;
        }

        .control-button:hover {
            background-color: #45a049;
        }
    </style>
</head>
<body>
    <header>
        <div class="logo">GoalGetter50</div>
        <nav>
            <a href="{{ url_for('index') }}">Home</a>
            <a href="{{ url_for('completed') }}">Completed</a>
            <a href="{{ url_for('archived') }}">Archived</a>
            <a href="{{ url_for('timer') }}">Timer</a>
            <a href="{{ url_for('notes') }}">Notes</a>
            <a href="{{ url_for('logout') }}" style="float: right;">Log Out</a>
        </nav>
    </header>

    <main>
        <h2>Sticky Notes</h2>
        <form id="noteForm">
            <input type="text" id="noteTitle" placeholder="Note Title" required>
            <textarea id="noteContent" placeholder="Write your note here..." required></textarea>
            <button type="submit" class="control-button">Add Note</button>
        </form>
        <div class="note-container" id="noteContainer"></div>
        <p id="refresh-text" class="neon-hover">Refresh Page After Adding Note</p>
    </main>

    <footer>
        <div class="theme-toggle">
            <label class="switch">
                <input type="checkbox" id="theme-switch">
                <span class="slider round"></span>
            </label>
            <span style="color: #4CAF50;">Dark Mode</span>
        </div>
        <div>
            <p style="color: #4CAF50;">Â© <span id="year"></span> GoalGetter50. All rights reserved.</p>
        </div>
    </footer>

    <script>
        document.getElementById('year').textContent = new Date().getFullYear();

        // Check for saved theme preference on page load
        window.onload = function() {
            if (localStorage.getItem('darkMode') === 'enabled') {
                document.body.classList.add('dark-mode');
                document.getElementById('theme-switch').checked = true; // Set the toggle to 'on'
            }
        };

        // Toggle dark mode
        document.getElementById('theme-switch').addEventListener('change', function() {
            document.body.classList.toggle('dark-mode');

            // Save the current theme preference
            if (document.body.classList.contains('dark-mode')) {
                localStorage.setItem('darkMode', 'enabled');
            } else {
                localStorage.setItem('darkMode', 'disabled');
            }
        });

        const noteContainer = document.getElementById('noteContainer');
        const noteForm = document.getElementById('noteForm');

        // Load existing notes
        fetch('/get_notes')
            .then(response => response.json())
            .then(notes => {
                notes.forEach(note => {
                    addNoteToDOM(note.title, note.content, note.id); // Pass the note ID
                });
            });

        noteForm.addEventListener('submit', function(e) {
            e.preventDefault();

            const title = document.getElementById('noteTitle').value;
            const content = document.getElementById('noteContent').value;

            fetch('/add_note', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ title, content }),
            }).then(response => response.json()).then(data => {
                if (data.id) { // Assuming the response includes the new note ID
                    addNoteToDOM(title, content, data.id); // Add note with ID
                    document.getElementById('noteTitle').value = '';
                    document.getElementById('noteContent').value = '';
                } else {
                    console.error('Error adding note.');
                }
            });
        });

        function addNoteToDOM(title, content, noteId) {
            const note = document.createElement('div');
            note.className = 'sticky-note';
            note.id = `note-${noteId}`; // Give it a unique ID
            note.style.transform = `rotate(${Math.random() * 10 - 5}deg)`;
            note.innerHTML =
                `<h3>${title}</h3>
                <textarea readonly>${content}</textarea>
                <button class="control-button removeNoteButton">Remove Note</button>`;

            // Add event listener to remove button
            note.querySelector('.removeNoteButton').addEventListener('click', function() {
                fetch(`/delete_note/${noteId}`, {
                    method: 'DELETE',
                }).then(response => {
                    if (response.ok) {
                        noteContainer.removeChild(note);
                        console.log('Note deleted successfully!');
                    } else {
                        console.error('Error deleting note.');
                    }
                });
            });

            noteContainer.appendChild(note);
        }
    </script>
</body>
</html>
